name: Telegram Bot Fast

on:
  schedule:
    - cron: '*/1 * * * *'
  workflow_dispatch:

jobs:
  fast-bot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      - name: Install dependencies
        run: pip install pyTelegramBotAPI gspread google-auth
      - name: Run bot
        env:
          GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}
        run: |
          echo "ü§ñ –ó–ê–ü–£–°–ö –ë–û–¢–ê –ö–ê–ñ–î–£–Æ –ú–ò–ù–£–¢–£"
          python -c "
import os
import telebot
from datetime import datetime

print('='*50)
print('ü§ñ –ë–û–¢ –î–ê–ù–ò–õ–ê –ú–ê–°–¢–ï–† –ó–ê–ü–£–©–ï–ù')
print('='*50)

BOT_TOKEN = '8133979508:AAERCJ0vygaJ-eSymRGEk1w5kzRZrp7SGi8'
ADMIN_IDS = [5537549230]

bot = telebot.TeleBot(BOT_TOKEN)

def get_offset():
    try:
        if os.path.exists('/tmp/last_offset.txt'):
            with open('/tmp/last_offset.txt', 'r') as f:
                return int(f.read().strip())
    except:
        pass
    return None

def save_offset(offset):
    try:
        with open('/tmp/last_offset.txt', 'w') as f:
            f.write(str(offset))
    except:
        pass

offset = get_offset()
print(f'üìä Offset: {offset}')

try:
    updates = bot.get_updates(offset=offset, timeout=5)
    print(f'üì® –°–æ–æ–±—â–µ–Ω–∏–π: {len(updates)}')
    
    if updates:
        new_offset = updates[-1].update_id + 1
        save_offset(new_offset)
        
        for update in updates:
            if update.message and update.message.text:
                msg = update.message
                text = msg.text.strip()
                user_id = msg.from_user.id
                chat_id = msg.chat.id
                
                print(f'üë§ User {user_id}: {text}')
                
                if user_id in ADMIN_IDS:
                    if text == '/start':
                        bot.send_message(chat_id, 'ü¶∑ *–ë–æ—Ç –î–∞–Ω–∏–ª–∞ –ú–∞—Å—Ç–µ—Ä*\\n\\n‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!\\nüìÖ ' + datetime.now().strftime('%d.%m.%Y %H:%M'), parse_mode='Markdown')
                    else:
                        bot.send_message(chat_id, f'‚úÖ –ü–æ–ª—É—á–µ–Ω–æ: {text}\\nüïê {datetime.now().strftime("%H:%M:%S")}')
                else:
                    bot.send_message(chat_id, '‚ùå –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞')
    
    print('‚úÖ –ì–æ—Ç–æ–≤–æ')
    
except Exception as e:
    print(f'‚ùå –û—à–∏–±–∫–∞: {e}')
          "
